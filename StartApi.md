# START API - Eldoleado Channels Integration

## Ğ”Ğ°Ñ‚Ğ° Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
**2 Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ 2025, 23:45 (UTC+4)**

---

## Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

```
Ğ’Ğ¡Ğ• API ĞšĞĞĞĞ›Ğ« Ğ—ĞĞ”Ğ•ĞŸĞ›ĞĞ•ĞĞ« Ğ˜ Ğ ĞĞ‘ĞĞ¢ĞĞ®Ğ¢!

Ğ Ğ°Ğ·Ğ²Ñ‘Ñ€Ğ½ÑƒÑ‚Ğ¾ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ 45.144.177.128:
- âœ… Avito MCP Server      â†’ Ğ¿Ğ¾Ñ€Ñ‚ 8765
- âœ… WhatsApp MCP Server   â†’ Ğ¿Ğ¾Ñ€Ñ‚ 8766 (Wappi.pro)
- âœ… VK MCP Server         â†’ Ğ¿Ğ¾Ñ€Ñ‚ 8767 (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ API)
- âœ… MAX MCP Server        â†’ Ğ¿Ğ¾Ñ€Ñ‚ 8768 (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ API)
- âœ… Instagram MCP Server  â†’ Ğ¿Ğ¾Ñ€Ñ‚ 8769 (Graph API)
- âœ… Form API Server       â†’ Ğ¿Ğ¾Ñ€Ñ‚ 8770

ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (ĞºĞ¾Ğ´ Ğ³Ğ¾Ñ‚Ğ¾Ğ²):
- ğŸ“¦ VK Ñ‡ĞµÑ€ĞµĞ· Wappi â†’ mcp-vk-wappi/
- ğŸ“¦ MAX Ñ‡ĞµÑ€ĞµĞ· Wappi â†’ mcp-max-wappi/

Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸:
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ credentials Ğ´Ğ»Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²
2. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ .env Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
3. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ webhooks Ğ² Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ…
4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ n8n workflows (BAT IN/OUT)
5. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ´ĞµĞ±Ğ°Ğ³

Ğ¡ĞµÑ€Ğ²ĞµÑ€ API: 45.144.177.128
SSH: root / Mi31415926pSss!
```

---

## Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

**ĞĞ’Ğ¢ĞĞĞĞœĞĞ«Ğ™ Ğ Ğ•Ğ–Ğ˜Ğœ** - Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹ Ğ²ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑÑ€Ğ°Ğ·Ñƒ Ğ±ĞµĞ· Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ°/Ğ½ĞµÑ‚:
- SSH ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°Ñ…
- Docker Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ/Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ API

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ĞšĞĞĞĞ›Ğ« ELDOLEADO                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚Telegram â”‚  â”‚  Avito  â”‚  â”‚   VK    â”‚  â”‚WhatsApp â”‚        â”‚
â”‚  â”‚  Bot    â”‚  â”‚   MCP   â”‚  â”‚   MCP   â”‚  â”‚   MCP   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚            â”‚            â”‚            â”‚              â”‚
â”‚       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚       â”‚     â”‚             â”‚           â”‚             â”‚      â”‚
â”‚       â–¼     â–¼             â–¼           â–¼             â–¼      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              n8n Workflows                          â”‚    â”‚
â”‚  â”‚  BAT IN {Channel} â†’ Processing â†’ BAT OUT {Channel}  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                 â”‚
â”‚                           â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              PostgreSQL Database                    â”‚    â”‚
â”‚  â”‚        clients, appeals, messages_history           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²

| ĞšĞ°Ğ½Ğ°Ğ» | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | URL/ĞŸĞ¾Ñ€Ñ‚ | API Key |
|-------|--------|----------|---------|
| **Telegram** | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | n8n Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ | Bot Token |
| **Avito** | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | 45.144.177.128:8765 | BattCRM_Avito_Secret_2024 |
| **WhatsApp** | âœ… Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | 45.144.177.128:8766 | BattCRM_WhatsApp_Secret_2024 |
| **VK** | âœ… Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | 45.144.177.128:8767 | BattCRM_VK_Secret_2024 |
| **MAX** | âœ… Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | 45.144.177.128:8768 | BattCRM_MAX_Secret_2024 |
| **Instagram** | âœ… Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | 45.144.177.128:8769 | BattCRM_Instagram_Secret_2024 |
| **Form** | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | 45.144.177.128:8770 | BattCRM_Form_Secret_2024 |
| **SMS** | â³ ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ | â€” | â€” |
| **Email** | â³ ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ | â€” | â€” |

---

## Ğ¡ĞµÑ€Ğ²ĞµÑ€Ñ‹

| Ğ¡ĞµÑ€Ğ²ĞµÑ€ | IP | ĞŸĞ¾Ñ€Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|--------|-----|------|-----------|
| **API Server** | 45.144.177.128 | 8765+ | MCP ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ² |
| **n8n** | n8n.n8nsrv.ru | 443 | Workflows |
| **Database** | 185.221.214.83 | 6544 | PostgreSQL |
| **Redis** | 185.221.214.83 | 6379 | Cache/Tokens |

### SSH Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñ‹

```bash
# API Server (Ğ´Ğ»Ñ MCP ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²)
ssh root@45.144.177.128
# Password: Mi31415926pSss!

# Database Server
ssh root@185.221.214.83
# Password: Mi31415926pS
```

---

## Avito MCP Server (Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ğ½ÑƒÑ‚)

### Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ

| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| URL | http://45.144.177.128:8765 |
| API Key | BattCRM_Avito_Secret_2024 |
| User ID | 157920214 |
| Client ID | trTwLtOgDpAtNnq412ec |
| ĞŸÑƒÑ‚ÑŒ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ | /opt/avito-api |

### ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

```bash
# Health check
curl http://45.144.177.128:8765/health

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½
curl -H "X-API-Key: BattCRM_Avito_Secret_2024" http://45.144.177.128:8765/api/token

# ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
curl -X POST http://45.144.177.128:8765/api/messages/send \
  -H "X-API-Key: BattCRM_Avito_Secret_2024" \
  -H "Content-Type: application/json" \
  -d '{"chat_id": "xxx", "text": "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚!"}'

# Ğ›Ğ¾Ğ³Ğ¸
ssh root@45.144.177.128 "docker logs avito-messenger-api --tail 50"

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº
ssh root@45.144.177.128 "cd /opt/avito-api && docker compose restart"
```

### API Endpoints

| Method | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|--------|----------|----------|
| GET | `/health` | Health check |
| GET | `/info` | Server info |
| GET | `/api/token` | ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ/Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½ |
| POST | `/api/token/refresh` | ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½ |
| GET | `/api/chats` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ‡Ğ°Ñ‚Ğ¾Ğ² |
| GET | `/api/chats/{id}` | Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ‡Ğ°Ñ‚Ğµ |
| GET | `/api/chats/{id}/messages` | Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ° |
| POST | `/api/messages/send` | ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ |
| POST | `/api/messages/send/image` | ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºÑƒ |
| POST | `/api/messages/send/bulk` | ĞœĞ°ÑÑĞ¾Ğ²Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° |
| POST | `/api/webhook/subscribe` | ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° webhook |
| POST | `/webhook/avito` | Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ¾Ñ‚ Avito |

---

## Form API Server (Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ğ½ÑƒÑ‚)

### Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ

| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| URL | http://45.144.177.128:8770 |
| API Key | BattCRM_Form_Secret_2024 |
| ĞŸÑƒÑ‚ÑŒ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ | /opt/form-api |

### ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

```bash
# Health check
curl http://45.144.177.128:8770/health

# ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ñƒ (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ endpoint)
curl -X POST http://45.144.177.128:8770/api/submit \
  -H "Content-Type: application/json" \
  -d '{"phone": "+79991234567", "name": "Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²", "form_id": "quiz_battery"}'

# ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ²Ğ¸Ğ·
curl -X POST http://45.144.177.128:8770/api/quiz \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "+79991234567",
    "name": "Ğ˜Ğ²Ğ°Ğ½",
    "form_id": "quiz_battery",
    "quiz_answers": [
      {"question": "ĞœĞ°Ñ€ĞºĞ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°", "answer": "iPhone"},
      {"question": "ĞœĞ¾Ğ´ĞµĞ»ÑŒ", "answer": "iPhone 12"}
    ]
  }'

# Ğ›Ğ¾Ğ³Ğ¸
ssh root@45.144.177.128 "docker logs form-submission-api --tail 50"

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº
ssh root@45.144.177.128 "cd /opt/form-api && docker compose restart"
```

### API Endpoints

| Method | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Auth |
|--------|----------|----------|------|
| GET | `/health` | Health check | - |
| GET | `/info` | Server info | - |
| POST | `/api/submit` | ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ñƒ | - |
| POST | `/api/quiz` | ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ²Ğ¸Ğ· | - |
| POST | `/api/callback` | Ğ—Ğ°ÑĞ²ĞºĞ° Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ·Ğ²Ğ¾Ğ½Ğ¾Ğº | - |
| POST | `/api/contact` | ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ° | - |
| POST | `/webhook/form` | Webhook Ğ´Ğ»Ñ Tilda Ğ¸ Ğ´Ñ€. | API Key |

### Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ„Ğ¾Ñ€Ğ¼Ñ‹

```javascript
{
  // ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ
  phone: "+79991234567",

  // ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ
  name: "Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²",
  email: "ivan@mail.ru",
  form_id: "quiz_battery",
  form_name: "ĞšĞ²Ğ¸Ğ· Ğ¿Ğ¾ Ğ°ĞºĞºÑƒĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°Ğ¼",
  message: "ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹",

  // ĞšĞ²Ğ¸Ğ·
  quiz_answers: [
    { question: "ĞœĞ°Ñ€ĞºĞ°", answer: "iPhone" },
    { question: "ĞœĞ¾Ğ´ĞµĞ»ÑŒ", answer: "12 Pro" }
  ],

  // ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  custom_data: { ... },

  // UTM Ğ¼ĞµÑ‚ĞºĞ¸
  utm_source: "google",
  utm_medium: "cpc",
  utm_campaign: "battery",
  referrer: "https://google.com",
  landing_page: "https://eldoleado.ru/quiz"
}
```

---

## ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²

### Ğ¤Ğ°Ğ·Ğ° 1: Avito (Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ)

- [x] MCP Server Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ğ½ÑƒÑ‚
- [x] Ğ¢Ğ¾ĞºĞµĞ½ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ÑÑ
- [ ] ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ webhook
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ BAT IN Avito
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ BAT OUT Avito
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚

**ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° webhook:**
```bash
curl -X POST http://45.144.177.128:8765/api/webhook/subscribe \
  -H "X-API-Key: BattCRM_Avito_Secret_2024" \
  -H "Content-Type: application/json" \
  -d '{"url": "http://45.144.177.128:8765/webhook/avito", "version": 2}'
```

### Ğ¤Ğ°Ğ·Ğ° 2: WhatsApp

**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸:**

| ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ | Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ | Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ | ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ |
|-----------|-----------|-----------|-------------|
| WAPPI | ~3000â‚½/Ğ¼ĞµÑ | ĞĞ¸Ğ·ĞºĞ°Ñ | ĞĞµĞ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ |
| 360dialog | $$ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ |
| WhatsApp Business API | $$$ | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ |

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° MCP ÑĞµÑ€Ğ²ĞµÑ€Ğ°:**
```
/opt/whatsapp-api/
â”œâ”€â”€ app.py
â”œâ”€â”€ whatsapp_client.py
â”œâ”€â”€ config.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ .env
```

### Ğ¤Ğ°Ğ·Ğ° 3: VK

**Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ:**
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ VK Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ access token
- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Callback API

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° MCP ÑĞµÑ€Ğ²ĞµÑ€Ğ°:**
```
/opt/vk-api/
â”œâ”€â”€ app.py
â”œâ”€â”€ vk_client.py
â”œâ”€â”€ config.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ .env
```

### Ğ¤Ğ°Ğ·Ğ° 4: MAX.ru

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Webhook API
- ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
- ĞŸĞ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Avito

---

## Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹

Ğ’ÑĞµ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹ Ğ¿Ñ€Ğ¸Ğ²Ğ¾Ğ´ÑÑ‚ÑÑ Ğº ĞµĞ´Ğ¸Ğ½Ğ¾Ğ¼Ñƒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñƒ:

```javascript
{
  channel: "telegram|avito|vk|whatsapp|max",
  external_user_id: "string",
  external_chat_id: "string",
  external_message_id: "string",

  text: "string",
  timestamp: "ISO 8601",

  client_name: "string|null",
  client_phone: "string|null",

  media: {
    has_voice: boolean,
    voice_url: "string|null",
    voice_transcribed_text: "string|null",
    has_images: boolean,
    images: [{url, file_id, caption}],
    has_video: boolean,
    has_document: boolean
  },

  meta: {
    ad_channel: "string",
    ad_id: "string|null",
    raw: {}
  }
}
```

---

## Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

| Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ | ĞŸÑƒÑ‚ÑŒ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|------|----------|
| Ğ¢Ğ— Avito | `docs/TZ_Avito_MCP_Integration.md` | ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Avito |
| ĞŸĞ»Ğ°Ğ½ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ² | `docs/Plan_Multi_Channel_Telegram_Avito.md` | ĞœÑƒĞ»ÑŒÑ‚Ğ¸ĞºĞ°Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° |
| ĞšĞ°Ğ½Ğ°Ğ»Ñ‹ Eldoleado | `Plans/eldoleado_channels_data.md` | Ğ’ÑĞµ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ |
| MCP Avito ĞºĞ¾Ğ´ | `mcp-avito/` | Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ¸ĞºĞ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ° |

---

## ĞŸĞ¾Ñ€Ñ‚Ñ‹ Ğ½Ğ° API ÑĞµÑ€Ğ²ĞµÑ€Ğµ

| ĞŸĞ¾Ñ€Ñ‚ | Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|------|--------|--------|
| 8765 | Avito MCP | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ |
| 8766 | WhatsApp MCP (Wappi.pro) | ğŸ“¦ ĞšĞ¾Ğ´ Ğ³Ğ¾Ñ‚Ğ¾Ğ² |
| 8767 | VK MCP (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ API v5.199) | ğŸ“¦ ĞšĞ¾Ğ´ Ğ³Ğ¾Ñ‚Ğ¾Ğ² |
| 8768 | MAX MCP (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ API platform-api.max.ru) | ğŸ“¦ ĞšĞ¾Ğ´ Ğ³Ğ¾Ñ‚Ğ¾Ğ² |
| 8770 | Form API | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ |
| 6379 | Redis | âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ |

---

## Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ MCP ÑĞµÑ€Ğ²ĞµÑ€Ğ°

Ğ”Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ½Ğ°Ğ»Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¸Ğ· `mcp-avito/`:

```bash
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ½Ğ°Ğ»Ğ°
mkdir -p mcp-{channel}
cp mcp-avito/*.py mcp-{channel}/
cp mcp-avito/Dockerfile mcp-{channel}/
cp mcp-avito/docker-compose.yml mcp-{channel}/
cp mcp-avito/requirements.txt mcp-{channel}/

# ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ API
# - {channel}_client.py - ĞºĞ»Ğ¸ĞµĞ½Ñ‚ API
# - app.py - endpoints
# - config.py - Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
# - .env - credentials
```

---

## Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ½Ğ°Ğ»Ğ°

ĞŸÑ€Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ½Ğ°Ğ»Ğ°:

- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ `mcp-{channel}/`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `{channel}_client.py`
- [ ] ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ `app.py`
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `config.py` Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ `docker-compose.yml`
- [ ] Ğ—Ğ°Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¸Ñ‚ÑŒ Ğ½Ğ° 45.144.177.128
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `BAT IN {Channel}` Ğ² n8n
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `BAT OUT {Channel}` Ğ² n8n
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Message Router
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ»
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

---

## Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

```
Host: 185.221.214.83
Port: 6544
Database: postgres
User: supabase_admin
Password: Mi31415926pS
```

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

```sql
-- ĞšĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹ Ñ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²
SELECT id, telegram_id, avito_id, vk_id, whatsapp_id, phone, name
FROM clients;

-- ĞĞ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ¼
SELECT id, channel, external_chat_id, status
FROM appeals;

-- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
SELECT id, channel, message_type, message_text, external_chat_id
FROM messages_history;
```

---

## n8n Workflows

| Workflow | ĞšĞ°Ğ½Ğ°Ğ» | ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ |
|----------|-------|-------------|
| BAT IN Telegram | Telegram | Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT OUT Telegram | Telegram | Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT IN Avito | Avito | Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT OUT Avito | Avito | Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT IN VK | VK | Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT OUT VK | VK | Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT IN WhatsApp | WhatsApp | Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT OUT WhatsApp | WhatsApp | Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT IN MAX | MAX | Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT OUT MAX | MAX | Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ |
| BAT Message Router | Ğ’ÑĞµ | ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ |

---

## Troubleshooting

### MCP Server Ğ½Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ
ssh root@45.144.177.128 "docker ps"

# ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸
ssh root@45.144.177.128 "docker logs avito-messenger-api --tail 100"

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ
ssh root@45.144.177.128 "cd /opt/avito-api && docker compose restart"
```

### ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ API

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ .env
ssh root@45.144.177.128 "cat /opt/avito-api/.env | grep -E 'CLIENT|SECRET|USER'"

# ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½
curl -X POST -H "X-API-Key: BattCRM_Avito_Secret_2024" \
  http://45.144.177.128:8765/api/token/refresh
```

### Webhook Ğ½Ğµ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ
curl -H "X-API-Key: BattCRM_Avito_Secret_2024" \
  http://45.144.177.128:8765/api/webhook/status

# ĞŸĞµÑ€ĞµĞ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ
curl -X POST http://45.144.177.128:8765/api/webhook/subscribe \
  -H "X-API-Key: BattCRM_Avito_Secret_2024" \
  -H "Content-Type: application/json" \
  -d '{"url": "http://45.144.177.128:8765/webhook/avito", "version": 2}'
```
