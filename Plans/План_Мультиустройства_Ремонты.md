# –ü–ª–∞–Ω: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ö–ª–∏–µ–Ω—Ç ‚Üí –ê–ø–ø–∞—Ä–∞—Ç(—ã) ‚Üí –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å(–∏)

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ —Å–æ–∑–¥–∞–Ω–æ)
- [x] `appeal_devices` - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∑–∞—è–≤–∫–µ (brand_id, model_id, device_order)
- [x] `appeal_repairs` - —Ä–µ–º–æ–Ω—Ç—ã –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (repair_category_id, issue_type_id, parts_owner)
- [x] `repair_categories` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–µ–º–æ–Ω—Ç–∞ (–î–∏—Å–ø–ª–µ–π, –ê–ö–ë, –ö–æ—Ä–ø—É—Å...)
- [x] `brands` - –±—Ä–µ–Ω–¥—ã (Apple, Samsung, Xiaomi...)
- [x] `models` - –º–æ–¥–µ–ª–∏ (iPhone 15, Galaxy S24...)

### API (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å)
- [ ] `API_Operator_Appeal_Detail` - –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å devices[] —Å repairs[]
- [ ] Android Entity - –¥–æ–±–∞–≤–∏—Ç—å devices/repairs

### Android UI (–Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å)
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ BottomSheet
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
–ó–∞—è–≤–∫–∞ (Appeal)
‚îú‚îÄ‚îÄ –ö–ª–∏–µ–Ω—Ç (client_name, client_phone)
‚îú‚îÄ‚îÄ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 1 (appeal_devices)
‚îÇ   ‚îú‚îÄ‚îÄ –ë—Ä–µ–Ω–¥: Apple
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥–µ–ª—å: iPhone 15 Pro
‚îÇ   ‚îú‚îÄ‚îÄ –†–µ–º–æ–Ω—Ç 1: –î–∏—Å–ø–ª–µ–π (–Ω–∞—à–∞ –∑–∞–ø—á–∞—Å—Ç—å)
‚îÇ   ‚îî‚îÄ‚îÄ –†–µ–º–æ–Ω—Ç 2: –ê–ö–ë (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è)
‚îú‚îÄ‚îÄ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 2 (appeal_devices)
‚îÇ   ‚îú‚îÄ‚îÄ –ë—Ä–µ–Ω–¥: Samsung
‚îÇ   ‚îú‚îÄ‚îÄ –ú–æ–¥–µ–ª—å: Galaxy S24
‚îÇ   ‚îî‚îÄ‚îÄ –†–µ–º–æ–Ω—Ç 1: –ö–æ—Ä–ø—É—Å
‚îî‚îÄ‚îÄ ...
```

---

## –®–∞–≥ 1: API - –û–±–Ω–æ–≤–∏—Ç—å API_Operator_Appeal_Detail

–¢–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø–ª–æ—Å–∫–∏–µ –ø–æ–ª—è. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```json
{
  "appeal_id": "uuid",
  "client_name": "–ò–≤–∞–Ω",
  "devices": [
    {
      "id": "uuid",
      "device_order": 1,
      "brand_name": "Apple",
      "model_name": "iPhone 15 Pro",
      "repairs": [
        {
          "id": "uuid",
          "repair_category_name": "–î–∏—Å–ø–ª–µ–π",
          "parts_owner": "–Ω–∞—à–∞",
          "estimated_cost": 15000,
          "status": "pending"
        }
      ]
    }
  ],
  ...
}
```

### SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ devices —Å repairs:

```sql
SELECT
  a.*,
  COALESCE(
    (SELECT json_agg(json_build_object(
      'id', ad.id,
      'device_order', ad.device_order,
      'brand_id', ad.brand_id,
      'brand_name', b.name,
      'model_id', ad.model_id,
      'model_name', m.name,
      'status', ad.status,
      'repairs', (
        SELECT json_agg(json_build_object(
          'id', ar.id,
          'repair_category_id', ar.repair_category_id,
          'repair_category_name', rc.name,
          'parts_owner', ar.parts_owner,
          'estimated_cost', ar.estimated_cost,
          'status', ar.status
        ) ORDER BY ar.priority)
        FROM appeal_repairs ar
        LEFT JOIN repair_categories rc ON rc.id = ar.repair_category_id
        WHERE ar.appeal_device_id = ad.id
      )
    ) ORDER BY ad.device_order)
    FROM appeal_devices ad
    LEFT JOIN brands b ON b.id = ad.brand_id
    LEFT JOIN models m ON m.id = ad.model_id
    WHERE ad.appeal_id = a.id
    ),
    '[]'::json
  ) as devices
FROM appeals a
WHERE a.id = $1;
```

---

## –®–∞–≥ 2: Android Entity

### AppealEntity.kt - –¥–æ–±–∞–≤–∏—Ç—å:

```kotlin
data class AppealDevice(
    val id: String,
    val deviceOrder: Int,
    val brandId: String?,
    val brandName: String?,
    val modelId: String?,
    val modelName: String?,
    val status: String?,
    val repairs: List<AppealRepair>
)

data class AppealRepair(
    val id: String,
    val repairCategoryId: String?,
    val repairCategoryName: String?,
    val partsOwner: String?,
    val estimatedCost: Double?,
    val status: String?
)

// –í AppealEntity –¥–æ–±–∞–≤–∏—Ç—å:
val devices: List<AppealDevice> = emptyList()
```

### ApiModels.kt - –¥–æ–±–∞–≤–∏—Ç—å:

```kotlin
data class DeviceDto(
    val id: String,
    val device_order: Int?,
    val brand_id: String?,
    val brand_name: String?,
    val model_id: String?,
    val model_name: String?,
    val status: String?,
    val repairs: List<RepairDto>?
)

data class RepairDto(
    val id: String,
    val repair_category_id: String?,
    val repair_category_name: String?,
    val parts_owner: String?,
    val estimated_cost: Double?,
    val status: String?
)
```

---

## –®–∞–≥ 3: Android UI - AppealInfoBottomSheet

### –û–±–Ω–æ–≤–∏—Ç—å layout bottom_sheet_appeal_info.xml:

```xml
<!-- –°–µ–∫—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
<LinearLayout
    android:id="@+id/devicesSection"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical">

    <TextView
        android:text="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"
        style="@style/SectionHeader"/>

    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/devicesRecyclerView"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"/>
</LinearLayout>
```

### –°–æ–∑–¥–∞—Ç—å DevicesAdapter:

```kotlin
class DevicesAdapter : RecyclerView.Adapter<DevicesAdapter.ViewHolder>() {
    private var devices: List<AppealDevice> = emptyList()

    fun updateDevices(newDevices: List<AppealDevice>) {
        devices = newDevices
        notifyDataSetChanged()
    }

    // ViewHolder –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:
    // - –ë—Ä–µ–Ω–¥ + –ú–æ–¥–µ–ª—å (–∑–∞–≥–æ–ª–æ–≤–æ–∫)
    // - –°–ø–∏—Å–æ–∫ —Ä–µ–º–æ–Ω—Ç–æ–≤ (–≤–ª–æ–∂–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç)
}
```

---

## –®–∞–≥ 4: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ø–∏—Å–æ–∫
```
üì± iPhone 15 Pro
   ‚Ä¢ –î–∏—Å–ø–ª–µ–π (–Ω–∞—à–∞)
   ‚Ä¢ –ê–ö–ë (–∫–ª–∏–µ–Ω—Ç–∞)

üì± Galaxy S24
   ‚Ä¢ –ö–æ—Ä–ø—É—Å
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üì± iPhone 15 Pro     [‚ñº]   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ –î–∏—Å–ø–ª–µ–π     15 000 ‚ÇΩ     ‚îÇ
‚îÇ ‚Ä¢ –ê–ö–ë          5 000 ‚ÇΩ     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **API**: –û–±–Ω–æ–≤–∏—Ç—å API_Operator_Appeal_Detail - –¥–æ–±–∞–≤–∏—Ç—å devices[]
2. **Android Models**: –î–æ–±–∞–≤–∏—Ç—å DeviceDto, RepairDto, AppealDevice, AppealRepair
3. **Android Parsing**: –û–±–Ω–æ–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ API ‚Üí Entity
4. **Android UI**: –û–±–Ω–æ–≤–∏—Ç—å BottomSheet –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è

1. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤/—Ä–µ–º–æ–Ω—Ç–æ–≤ –Ω—É–∂–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä?
2. –ù—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞?
3. –§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: –ø—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏?
4. –ù—É–∂–Ω–æ –ª–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤?
